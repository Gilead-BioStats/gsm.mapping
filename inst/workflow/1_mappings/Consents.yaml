meta:
  Type: Mapped
  ID: Consents
  Description: Consent Data Mapping
  Priority: 2
spec:
  Raw_Consents:
    studyid:
      type: character
    #subjid:
    #  type: character
    subjectid:
      type: character
    cons_dt:
      type: character
    constype:
      type: character
    conscat:
      type: character
  Mapped_SUBJ:
    subjid:
      type: character
    subjectid:
      type: character
  Mapped_STUDCOMP:
    _all:
      required: true
steps:
  - output: Temp_SubjectLookup
    name: dplyr::select
    params:
      .data: Mapped_SUBJ
      subjid: subjid
      subjectid: subjectid

  - output: Temp_Consents
    name: dplyr::left_join
    params:
      x: Raw_Consents
      "y": Temp_SubjectLookup
      by: subjectid

  - output: Temp_Consents1
    name: gsm.core::RunQuery
    params:
      df: Temp_Consents
      strQuery: |
        SELECT *
        FROM df
        WHERE constype = 'WITHDRAWAL OF CONSENT'
          AND conscat = 'MAIN STUDY CONSENT'

  - output: Mapped_Consents
    name: gsm.endpoints::complete_consents
    params:
      dfConsents: Temp_Consents1
      dfStudyCompletion: Mapped_STUDCOMP

